/**
 * skylark-bootstrap4 - The skylark bootstrap4 component library
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-bootstrap4/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/query","skylark-utils-dom/plugins","./bs4","skylark-ui-popper/Popper","./util"],function(e,t,n,s,i,r){"use strict";const o="dropdown",a="4.1.3",l="bs.dropdown",h=`.${l}`,c=t.fn[o],u=27,d=32,_=9,f=38,p=40,g=3,m=new RegExp(`${f}|${p}|${u}`),E={HIDE:`hide${h}`,HIDDEN:`hidden${h}`,SHOW:`show${h}`,SHOWN:`shown${h}`,CLICK:`click${h}`,CLICK_DATA_API:`click${h}.data-api`,KEYDOWN_DATA_API:`keydown${h}.data-api`,KEYUP_DATA_API:`keyup${h}.data-api`},D={DISABLED:"disabled",SHOW:"show",DROPUP:"dropup",DROPRIGHT:"dropright",DROPLEFT:"dropleft",MENURIGHT:"dropdown-menu-right",MENULEFT:"dropdown-menu-left",POSITION_STATIC:"position-static"},T={DATA_TOGGLE:'[data-toggle="dropdown"]',FORM_CHILD:".dropdown form",MENU:".dropdown-menu",NAVBAR_NAV:".navbar-nav",VISIBLE_ITEMS:".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)"},A={TOP:"top-start",TOPEND:"top-end",BOTTOM:"bottom-start",BOTTOMEND:"bottom-end",RIGHT:"right-start",RIGHTEND:"right-end",LEFT:"left-start",LEFTEND:"left-end"},O={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic"},I={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string"};class y{constructor(e,t){this._element=e,this._popper=null,this._config=this._getConfig(t),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}static get VERSION(){return a}static get Default(){return O}static get DefaultType(){return I}toggle(){if(this._element.disabled||t(this._element).hasClass(D.DISABLED))return;const e=y._getParentFromElement(this._element),n=t(this._menu).hasClass(D.SHOW);if(y._clearMenus(),n)return;const s={relatedTarget:this._element},o=t.Event(E.SHOW,s);if(t(e).trigger(o),!o.isDefaultPrevented()){if(!this._inNavbar){if(void 0===i)throw new TypeError("Bootstrap's dropdowns require skylark-ui-popper/Popper (https://skylark-ui-popper/Popper.org/)");let n=this._element;"parent"===this._config.reference?n=e:r.isElement(this._config.reference)&&(n=this._config.reference,typeof this._config.reference.skylark-utils-dom/query!=="undefined"&&(n=this._config.reference[0])),"scrollParent"!==this._config.boundary&&t(e).addClass(D.POSITION_STATIC),this._popper=new i(n,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===t(e).closest(T.NAVBAR_NAV).length&&t(document.body).children().on("mouseover",null,t.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),t(this._menu).toggleClass(D.SHOW),t(e).toggleClass(D.SHOW).trigger(t.Event(E.SHOWN,s))}}show(){if(this._element.disabled||t(this._element).hasClass(D.DISABLED)||t(this._menu).hasClass(D.SHOW))return;const e={relatedTarget:this._element},n=t.Event(E.SHOW,e),s=y._getParentFromElement(this._element);t(s).trigger(n),n.isDefaultPrevented()||(t(this._menu).toggleClass(D.SHOW),t(s).toggleClass(D.SHOW).trigger(t.Event(E.SHOWN,e)))}hide(){if(this._element.disabled||t(this._element).hasClass(D.DISABLED)||!t(this._menu).hasClass(D.SHOW))return;const e={relatedTarget:this._element},n=t.Event(E.HIDE,e),s=y._getParentFromElement(this._element);t(s).trigger(n),n.isDefaultPrevented()||(t(this._menu).toggleClass(D.SHOW),t(s).toggleClass(D.SHOW).trigger(t.Event(E.HIDDEN,e)))}dispose(){t.removeData(this._element,l),t(this._element).off(h),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}update(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}_addEventListeners(){t(this._element).on(E.CLICK,e=>{e.preventDefault(),e.stopPropagation(),this.toggle()})}_getConfig(n){return n=e.mixin({},this.constructor.Default,t(this._element).data(),n),r.typeCheckConfig(o,n,this.constructor.DefaultType),n}_getMenuElement(){if(!this._menu){const e=y._getParentFromElement(this._element);e&&(this._menu=e.querySelector(T.MENU))}return this._menu}_getPlacement(){const e=t(this._element.parentNode);let n=A.BOTTOM;return e.hasClass(D.DROPUP)?(n=A.TOP,t(this._menu).hasClass(D.MENURIGHT)&&(n=A.TOPEND)):e.hasClass(D.DROPRIGHT)?n=A.RIGHT:e.hasClass(D.DROPLEFT)?n=A.LEFT:t(this._menu).hasClass(D.MENURIGHT)&&(n=A.BOTTOMEND),n}_detectNavbar(){return t(this._element).closest(".navbar").length>0}_getPopperConfig(){const t={};"function"==typeof this._config.offset?t.fn=(t=>(e.mixin(t.offsets,this._config.offset(t.offsets)||{}),t)):t.offset=this._config.offset;const n={placement:this._getPlacement(),modifiers:{offset:t,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(n.modifiers.applyStyle={enabled:!1}),n}static _jqueryInterface(e){return this.each(function(){let n=t(this).data(l);if(n||(n=new y(this,"object"==typeof e?e:null),t(this).data(l,n)),"string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`);n[e]()}})}static _clearMenus(e){if(e&&(e.which===g||"keyup"===e.type&&e.which!==_))return;const n=[].slice.call(document.querySelectorAll(T.DATA_TOGGLE));for(let s=0,i=n.length;s<i;s++){const i=y._getParentFromElement(n[s]),r=t(n[s]).data(l),o={relatedTarget:n[s]};if(e&&"click"===e.type&&(o.clickEvent=e),!r)continue;const a=r._menu;if(!t(i).hasClass(D.SHOW))continue;if(e&&("click"===e.type&&/input|textarea/i.test(e.target.tagName)||"keyup"===e.type&&e.which===_)&&t.contains(i,e.target))continue;const h=t.Event(E.HIDE,o);t(i).trigger(h),h.isDefaultPrevented()||("ontouchstart"in document.documentElement&&t(document.body).children().off("mouseover",null,t.noop),n[s].setAttribute("aria-expanded","false"),t(a).removeClass(D.SHOW),t(i).removeClass(D.SHOW).trigger(t.Event(E.HIDDEN,o)))}}static _getParentFromElement(e){let t;const n=r.getSelectorFromElement(e);return n&&(t=document.querySelector(n)),t||e.parentNode}static _dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?e.which===d||e.which!==u&&(e.which!==p&&e.which!==f||t(e.target).closest(T.MENU).length):!m.test(e.which))return;if(e.preventDefault(),e.stopPropagation(),this.disabled||t(this).hasClass(D.DISABLED))return;const n=y._getParentFromElement(this),s=t(n).hasClass(D.SHOW);if(!s||s&&(e.which===u||e.which===d)){if(e.which===u){const e=n.querySelector(T.DATA_TOGGLE);t(e).trigger("focus")}return void t(this).trigger("click")}const i=[].slice.call(n.querySelectorAll(T.VISIBLE_ITEMS));if(0===i.length)return;let r=i.indexOf(e.target);e.which===f&&r>0&&r--,e.which===p&&r<i.length-1&&r++,r<0&&(r=0),i[r].focus()}}return t(document).on(E.KEYDOWN_DATA_API,T.DATA_TOGGLE,y._dataApiKeydownHandler).on(E.KEYDOWN_DATA_API,T.MENU,y._dataApiKeydownHandler).on(`${E.CLICK_DATA_API} ${E.KEYUP_DATA_API}`,y._clearMenus).on(E.CLICK_DATA_API,T.DATA_TOGGLE,function(e){e.preventDefault(),e.stopPropagation(),y._jqueryInterface.call(t(this),"toggle")}).on(E.CLICK_DATA_API,T.FORM_CHILD,e=>{e.stopPropagation()}),t.fn[o]=y._jqueryInterface,t.fn[o].Constructor=y,t.fn[o].noConflict=(()=>(t.fn[o]=c,y._jqueryInterface)),y});
//# sourceMappingURL=sourcemaps/dropdown.js.map
