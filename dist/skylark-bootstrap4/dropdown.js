/**
 * skylark-bootstrap4 - The skylark bootstrap4 component library
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-bootstrap4/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/query","skylark-utils-dom/eventer","skylark-utils-dom/plugins","./bs4","skylark-ui-popper/Popper","./util"],function(e,t,n,s,r,i,o){"use strict";const a="dropdown",l="4.1.3",c="bs.dropdown",h=`.${c}`,u=t.fn[a],d=27,_=32,f=9,p=38,g=40,m=3,E=new RegExp(`${p}|${g}|${d}`),D={HIDE:`hide${h}`,HIDDEN:`hidden${h}`,SHOW:`show${h}`,SHOWN:`shown${h}`,CLICK:`click${h}`,CLICK_DATA_API:`click${h}.data-api`,KEYDOWN_DATA_API:`keydown${h}.data-api`,KEYUP_DATA_API:`keyup${h}.data-api`},T={DISABLED:"disabled",SHOW:"show",DROPUP:"dropup",DROPRIGHT:"dropright",DROPLEFT:"dropleft",MENURIGHT:"dropdown-menu-right",MENULEFT:"dropdown-menu-left",POSITION_STATIC:"position-static"},A={DATA_TOGGLE:'[data-toggle="dropdown"]',FORM_CHILD:".dropdown form",MENU:".dropdown-menu",NAVBAR_NAV:".navbar-nav",VISIBLE_ITEMS:".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)"},O={TOP:"top-start",TOPEND:"top-end",BOTTOM:"bottom-start",BOTTOMEND:"bottom-end",RIGHT:"right-start",RIGHTEND:"right-end",LEFT:"left-start",LEFTEND:"left-end"},I={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic"},y={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string"};class P{constructor(e,t){this._element=e,this._popper=null,this._config=this._getConfig(t),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}static get VERSION(){return l}static get Default(){return I}static get DefaultType(){return y}toggle(){if(this._element.disabled||t(this._element).hasClass(T.DISABLED))return;const e=P._getParentFromElement(this._element),s=t(this._menu).hasClass(T.SHOW);if(P._clearMenus(),s)return;const r={relatedTarget:this._element},a=n.create(D.SHOW,r);if(t(e).trigger(a),!a.isDefaultPrevented()){if(!this._inNavbar){if(void 0===i)throw new TypeError("Bootstrap's dropdowns require skylark-ui-popper/Popper (https://skylark-ui-popper/Popper.org/)");let n=this._element;"parent"===this._config.reference?n=e:o.isElement(this._config.reference)&&(n=this._config.reference,typeof this._config.reference.skylark-utils-dom/query!=="undefined"&&(n=this._config.reference[0])),"scrollParent"!==this._config.boundary&&t(e).addClass(T.POSITION_STATIC),this._popper=new i(n,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===t(e).closest(A.NAVBAR_NAV).length&&t(document.body).children().on("mouseover",null,t.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),t(this._menu).toggleClass(T.SHOW),t(e).toggleClass(T.SHOW).trigger(n.create(D.SHOWN,r))}}show(){if(this._element.disabled||t(this._element).hasClass(T.DISABLED)||t(this._menu).hasClass(T.SHOW))return;const e={relatedTarget:this._element},s=n.create(D.SHOW,e),r=P._getParentFromElement(this._element);t(r).trigger(s),s.isDefaultPrevented()||(t(this._menu).toggleClass(T.SHOW),t(r).toggleClass(T.SHOW).trigger(n.create(D.SHOWN,e)))}hide(){if(this._element.disabled||t(this._element).hasClass(T.DISABLED)||!t(this._menu).hasClass(T.SHOW))return;const e={relatedTarget:this._element},s=n.create(D.HIDE,e),r=P._getParentFromElement(this._element);t(r).trigger(s),s.isDefaultPrevented()||(t(this._menu).toggleClass(T.SHOW),t(r).toggleClass(T.SHOW).trigger(n.create(D.HIDDEN,e)))}dispose(){t.removeData(this._element,c),t(this._element).off(h),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}update(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}_addEventListeners(){t(this._element).on(D.CLICK,e=>{e.preventDefault(),e.stopPropagation(),this.toggle()})}_getConfig(n){return n=e.mixin({},this.constructor.Default,t(this._element).data(),n),o.typeCheckConfig(a,n,this.constructor.DefaultType),n}_getMenuElement(){if(!this._menu){const e=P._getParentFromElement(this._element);e&&(this._menu=e.querySelector(A.MENU))}return this._menu}_getPlacement(){const e=t(this._element.parentNode);let n=O.BOTTOM;return e.hasClass(T.DROPUP)?(n=O.TOP,t(this._menu).hasClass(T.MENURIGHT)&&(n=O.TOPEND)):e.hasClass(T.DROPRIGHT)?n=O.RIGHT:e.hasClass(T.DROPLEFT)?n=O.LEFT:t(this._menu).hasClass(T.MENURIGHT)&&(n=O.BOTTOMEND),n}_detectNavbar(){return t(this._element).closest(".navbar").length>0}_getPopperConfig(){const t={};"function"==typeof this._config.offset?t.fn=(t=>(e.mixin(t.offsets,this._config.offset(t.offsets)||{}),t)):t.offset=this._config.offset;const n={placement:this._getPlacement(),modifiers:{offset:t,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(n.modifiers.applyStyle={enabled:!1}),n}static _jqueryInterface(e){return this.each(function(){let n=t(this).data(c);if(n||(n=new P(this,"object"==typeof e?e:null),t(this).data(c,n)),"string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`);n[e]()}})}static _clearMenus(e){if(e&&(e.which===m||"keyup"===e.type&&e.which!==f))return;const s=[].slice.call(document.querySelectorAll(A.DATA_TOGGLE));for(let r=0,i=s.length;r<i;r++){const i=P._getParentFromElement(s[r]),o=t(s[r]).data(c),a={relatedTarget:s[r]};if(e&&"click"===e.type&&(a.clickEvent=e),!o)continue;const l=o._menu;if(!t(i).hasClass(T.SHOW))continue;if(e&&("click"===e.type&&/input|textarea/i.test(e.target.tagName)||"keyup"===e.type&&e.which===f)&&t.contains(i,e.target))continue;const h=n.create(D.HIDE,a);t(i).trigger(h),h.isDefaultPrevented()||("ontouchstart"in document.documentElement&&t(document.body).children().off("mouseover",null,t.noop),s[r].setAttribute("aria-expanded","false"),t(l).removeClass(T.SHOW),t(i).removeClass(T.SHOW).trigger(n.create(D.HIDDEN,a)))}}static _getParentFromElement(e){let t;const n=o.getSelectorFromElement(e);return n&&(t=document.querySelector(n)),t||e.parentNode}static _dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?e.which===_||e.which!==d&&(e.which!==g&&e.which!==p||t(e.target).closest(A.MENU).length):!E.test(e.which))return;if(e.preventDefault(),e.stopPropagation(),this.disabled||t(this).hasClass(T.DISABLED))return;const n=P._getParentFromElement(this),s=t(n).hasClass(T.SHOW);if(!s||s&&(e.which===d||e.which===_)){if(e.which===d){const e=n.querySelector(A.DATA_TOGGLE);t(e).trigger("focus")}return void t(this).trigger("click")}const r=[].slice.call(n.querySelectorAll(A.VISIBLE_ITEMS));if(0===r.length)return;let i=r.indexOf(e.target);e.which===p&&i>0&&i--,e.which===g&&i<r.length-1&&i++,i<0&&(i=0),r[i].focus()}}return t(document).on(D.KEYDOWN_DATA_API,A.DATA_TOGGLE,P._dataApiKeydownHandler).on(D.KEYDOWN_DATA_API,A.MENU,P._dataApiKeydownHandler).on(`${D.CLICK_DATA_API} ${D.KEYUP_DATA_API}`,P._clearMenus).on(D.CLICK_DATA_API,A.DATA_TOGGLE,function(e){e.preventDefault(),e.stopPropagation(),P._jqueryInterface.call(t(this),"toggle")}).on(D.CLICK_DATA_API,A.FORM_CHILD,e=>{e.stopPropagation()}),t.fn[a]=P._jqueryInterface,t.fn[a].Constructor=P,t.fn[a].noConflict=(()=>(t.fn[a]=u,P._jqueryInterface)),P});
//# sourceMappingURL=sourcemaps/dropdown.js.map
